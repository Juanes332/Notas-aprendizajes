---
id: 2025072601
tags:
  - Cibersecurity
  - Offsec
  - Console
  - Linux
  - Commands
  - español
type: permanent
author: Offsec
---

## 7.1. How Vulnerability Scanners Work

### Proceso general de un escáner de vulnerabilidades automatizado

Aunque cada escáner de vulnerabilidades tiene su propio flujo personalizado, el proceso subyacente es común y consiste en los siguientes pasos:

1. **Descubrimiento de hosts (Host Discovery)**  
    El escáner determina si el objetivo está activo y responde.
    
2. **Escaneo de puertos (Port Scanning)**  
    Se identifican los puertos abiertos en el sistema.
    
3. **Detección del sistema operativo, servicios y versiones**  
    El escáner detecta los sistemas operativos, servicios accesibles remotamente y sus versiones correspondientes.
    
4. **Comparación con una base de datos de vulnerabilidades**  
    Con la información recolectada, el escáner consulta una base de datos de vulnerabilidades para correlacionar servicios y versiones detectadas con vulnerabilidades conocidas.
    

Ejemplos de bases de datos de vulnerabilidades:

- **NVD  [_National Vulnerability Database_](https://nvd.nist.gov)**
    
- **CVE [_Common Vulnerabilities and Exposures_](https://cve.mitre.org/cve/search_cve_list.html)
    

Algunos escáneres comerciales también intentan verificar las vulnerabilidades encontradas mediante la explotación parcial o completa de estas, lo que puede ayudar a reducir falsos negativos, aunque puede comprometer la estabilidad del sistema objetivo.

---

### Identificación y evaluación de vulnerabilidades

Las vulnerabilidades se identifican mediante el sistema **CVE**, que proporciona identificadores únicos, pero **no indica su gravedad**.

Para evaluar la severidad, se utiliza el **CVSS (Common Vulnerability Scoring System)**, un marco que asigna puntuaciones a las vulnerabilidades. Las versiones más usadas son **CVSS v2** y **CVSS v3**, ambas con un rango de puntuación de 0 a 10, acompañado de etiquetas de severidad.

Desde 2019, se utiliza también **CVSS v3.1**, que mejora la versión anterior.

Las puntuaciones CVSS pueden obtenerse:

- Revisando el CVE en una base de datos
    
- Calculándolas manualmente con un **[_CVSS calculator_](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator)**, en caso de que no exista un CVE
    


---

### Precisión de los escaneos: falsos positivos y negativos

- **Falsos positivos**: cuando el escáner reporta una vulnerabilidad que realmente no está presente. Esto puede deberse a errores en la detección del servicio o versión, configuraciones particulares del sistema, o **backporting** (cuando parches de seguridad se aplican a versiones anteriores del software).
    
- **Falsos negativos**: cuando el escáner no detecta una vulnerabilidad real.
    

---

### Escaneo manual vs. automatizado

- **Escaneo manual**: consume muchos recursos y tiempo, pero permite detectar vulnerabilidades complejas o lógicas que no pueden ser identificadas automáticamente. Tiene limitaciones humanas, como la carga cognitiva ante grandes volúmenes de datos.
    
- **Escaneo automatizado**: es fundamental en pruebas a gran escala por su rapidez y eficiencia. Detecta vulnerabilidades comunes y conocidas, siendo útil especialmente en redes empresariales grandes o con restricciones de tiempo.
    

---

### Consideraciones para el uso de escáneres automáticos

Es importante entender el funcionamiento interno de cada herramienta utilizada. Esto permite:

- Configurar correctamente el escáner
    
- Interpretar adecuadamente los resultados
    
- Reconocer sus limitaciones, que deben ser compensadas mediante análisis manual y experiencia

---

## 7.1.2. Types of Vulnerability Scans

Los escaneos de vulnerabilidades pueden clasificarse principalmente según dos criterios:

1. **Ubicación del escaneo**: externo vs. interno
    
2. **Nivel de acceso**: autenticado vs. no autenticado
    

#### 1. Escaneo externo vs. escaneo interno

- **Escaneo externo**  
    Se realiza desde fuera de la red de la organización, simulando un atacante externo.  
    El objetivo es evaluar los sistemas accesibles desde Internet (como aplicaciones web, servicios en la DMZ, y sistemas de cara al público).  
    El cliente usualmente proporciona una lista de direcciones IP para escanear, aunque en algunos casos se requiere identificar todos los sistemas expuestos sin asistencia previa.  
    Este tipo de escaneo puede revelar activos expuestos que la organización desconoce.
    
- **Escaneo interno**  
    Se realiza desde dentro de la red del cliente, con acceso directo a segmentos internos o a la red completa.  
    Puede hacerse a través de una conexión VPN o físicamente en sitio.  
    El propósito es identificar vulnerabilidades internas que podrían ser explotadas si un atacante logra superar el perímetro de seguridad.  
    Permite evaluar vectores de ataque posteriores a una intrusión inicial.
    

#### 2. Escaneo autenticado vs. no autenticado

- **Escaneo no autenticado**  
    Se ejecuta sin credenciales de acceso.  
    Evalúa únicamente los servicios accesibles remotamente, identificando puertos abiertos, servicios y versiones expuestas, y los compara con bases de datos de vulnerabilidades.  
    No puede detectar vulnerabilidades locales, como parches faltantes o configuraciones inseguras.  
    Ejemplo: no permite verificar si un sistema Windows está parcheado contra la vulnerabilidad **[_HiveNightmare_](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36934)**, que permite leer archivos sensibles sin privilegios.
    
- **Escaneo autenticado**  
    Se realiza proporcionando credenciales válidas al escáner (preferiblemente con privilegios elevados).  
    Permite acceso profundo al sistema objetivo para detectar:
    
    - Paquetes vulnerables instalados
        
    - Parches faltantes
        
    - Configuraciones inseguras o incorrectas  
        Es esencial para evaluar con precisión la postura de seguridad interna del sistema.
        

---
## 7.1.3. Things to consider in a Vulnerability Scan
En evaluaciones grandes, la configuración del escáner de vulnerabilidades debe hacerse cuidadosamente para asegurar que los resultados sean precisos, relevantes y útiles.

#### 1. Duración del escaneo

- La duración varía en función del tipo de escaneo (externo/interno, autenticado/no autenticado) y la cantidad de objetivos.
    
- **Escaneos externos** a través de Internet suelen tardar más debido a múltiples saltos e infraestructuras intermedias (routers, firewalls).
    
- Cuando se trabaja con una gran cantidad de direcciones IP, es crucial planificar con suficiente anticipación.
    

#### 2. Visibilidad del objetivo

- Ingresar una dirección IP en el escáner es simple, pero no garantiza que el objetivo sea accesible.
    
- Es necesario validar si los sistemas a escanear están accesibles directamente o si requieren túneles VPN o reglas de firewall específicas.
    
- Si el cliente proporciona una lista de IPs para escaneo externo, normalmente esos sistemas están expuestos públicamente.
    
- Sin embargo, si se requiere mapear toda la superficie de ataque externa por cuenta propia, se deben considerar limitaciones impuestas por **firewalls, geobloqueo** u otras medidas de restricción de acceso.
    

**Ejemplo**:  
En un entorno internacional, un cliente puede tener sistemas en distintos países con políticas de acceso que restringen las conexiones provenientes del exterior. Desde nuestra ubicación, solo podríamos escanear los sistemas locales, mientras que los sistemas en otros países quedarían inaccesibles.

- En escaneos internos, también hay que tener en cuenta la ubicación del escáner dentro de la red para lograr una visibilidad adecuada de otros subredes.
    
- **Dispositivos intermedios** como routers, firewalls o sistemas de prevención de intrusos (IPS) pueden bloquear o modificar paquetes, afectando la detección de hosts o servicios.
    

**Ejemplo**:  
Si un dispositivo intermedio bloquea los paquetes ICMP durante el paso de "Host Discovery", el escáner puede marcar erróneamente al host como inactivo.

#### 3. Limitaciones por "rate limiting"

- Algunas redes imponen **límites de tráfico** para evitar sobrecargas (por número de paquetes, conexiones o volumen de datos).
    
- Si el escáner sobrepasa estos límites, puede ser ralentizado o bloqueado por la red.
    
- Esto puede provocar omisiones en la detección de hosts vivos o servicios activos.
    
- Para mitigar esto, muchos escáneres permiten configurar:
    
    - Retardos entre solicitudes
    - Tiempos de espera (timeouts)
    - Número máximo de conexiones paralelas


#### 4. Impacto sobre la red y los sistemas

- El escaneo genera un gran volumen de tráfico, especialmente cuando se analizan múltiples objetivos en paralelo.
    
- Esto puede saturar la red, causar degradación de servicios o incluso interrumpir operaciones normales.
    
- La **estabilidad del sistema objetivo** también puede verse comprometida. Algunas pruebas del escáner pueden provocar errores, bloqueos o interrupciones en servicios críticos.
    
- Medidas de mitigación:
    
    - Reducir la velocidad del escaneo
    - Disminuir la cantidad de escaneos paralelos
    - Coordinar ventanas de escaneo con el cliente para minimizar el riesgo en horas productivas

---

## 7.2. Vulnerability Scanning with Nessus

Nessus es una de las herramientas de escaneo de vulnerabilidades más famosas, contiene alrededor de 67000 [CVEs](https://cve.mitre.org) y [168000 plugins](https://www.tenable.com/plugins).

Nessus viene en dos versiones _Nessus Essentials_ y _Nessus Professional_. Para este caso vamos a usar la version gratuita de Nessus (essentials), el cual viene con algunas restricciones y limitaciones. Por ejemplo solo podremos escanear 16 diferentes direcciones IP y algunas plantillas y configuraciones no están disponibles

---
## 7.2.1. Installing Nessus

Nessus tiene los siguientes requisitos mínimos: 4 CPU cores y 8GB de ram -->  [_Tenable_ recommends](https://docs.tenable.com/generalrequirements/Content/NessusScannerHardwareRequirements.htm)

Principalmente debemos ir a la pagina y seleccionar el paquete respectivo para nuestro OS.

![[Pasted image 20250716122804.png]]

Después de descargarlo debemos validar la suma de comprobación sha256, para ello damos click en checksum y copiamos el sha256 que nos devuelve y escribimos los siguiente comandos:

```bash
echo "4987776fef98bb2a72515abc0529e90572778b1d7aeeb1939179ff1f4de1440d Nessus-10.5.0-debian10_amd64.deb" > sha256sum_nessus

sha256sum -c sha256sum_nessus
Nessus-10.5.0-debian10_amd64.deb: OK
```

El match ha salido con éxito, significa que podemos instalar el paquete. Si Nessus se hubiera actualizado nos mostraría un resultado diferente al de la suma y tendriamos que adaptarlo. Para instalarlo usamos el siguiente comando 

```bash
sudo dpkg -i Nessus-10.5.0-debian10_amd64.deb
```

Después de la instalación iniciamos el sevicio

```bash
sudo systemctl start nessusd.service
```

Cuando inicie podemos acceder a el por el portal del navegador a través de la siguiente url: https://127.0.0.1:8834 . Este nos va a mostrar que el sitio no es seguro así que solo le damos en avanzado y continuamos.

![[Pasted image 20250716123512.png]]

Después se nos mostrará un portal y podremos seguir con los pasos de instalación

![[Pasted image 20250716123544.png]]

![[Pasted image 20250716123552.png]]

![[Pasted image 20250716123612.png]]

![[Pasted image 20250716123619.png]]

![[Pasted image 20250716123623.png]]

Finalmente esperamos que carguen los plugins 

![[Pasted image 20250716123641.png]]

---

## 7.2.2. Nessus Components

Antes de realizar un escaneo de vulnerabilidades con Nessus, es importante familiarizarse con su interfaz y arquitectura básica. En la versión **Nessus Essentials**, los componentes clave están organizados en dos pestañas principales:

![[Pasted image 20250716130713.png]]

#### 1. **Pestaña Settings (Configuración)**

- Permite ajustar la configuración general de la aplicación, incluyendo:
    - Configuración de un servidor **SMTP** para envío de resultados por correo electrónico.
    - Opciones avanzadas de configuración relacionadas con la **interfaz de usuario**, comportamiento de escaneos, registro de eventos (logs), seguridad y rendimiento.
        
- El submenú **About** proporciona información general:
    
    - Versión del software
    - Detalles de la licencia
    - Cantidad de hosts restantes disponibles según la licencia
        

Para una configuración más detallada, se puede consultar la documentación oficial de Nessus.

#### 2. **Pestaña Scans (Escaneos)**

Incluye dos secciones clave:

##### a. **Policies (Políticas)**

- Una política en Nessus es un conjunto de configuraciones predefinidas aplicables a un escaneo.
    
- Las políticas pueden guardarse y reutilizarse como plantillas para nuevos escaneos.
    

##### b. **Scan Templates (Plantillas de escaneo)**

Nessus ofrece múltiples plantillas clasificadas en tres categorías:

- **Discovery**  
    Contiene la plantilla _Host Discovery_, que permite identificar sistemas activos y sus puertos abiertos.
    
- **Vulnerabilities**  
    Incluye plantillas orientadas a vulnerabilidades críticas específicas (por ejemplo, _PrintNightmare_ o _Zerologon_) y otras de propósito general, como:
    - _Web Application Tests_
    - _Malware Scan_
    
- **Compliance**  
    Solo disponible en la versión Enterprise. También lo está la plantilla _Mobile Device Scan_.
    

#### 3. **Plantillas generales de escaneo de vulnerabilidades**

Nessus proporciona tres plantillas generales para escaneos de red:

- **Basic Network Scan**  
    Plantilla recomendada por defecto. Incluye la mayoría de las configuraciones predefinidas y detecta una amplia gama de vulnerabilidades. Es personalizable.
- **Advanced Scan**  
    No contiene configuraciones preestablecidas. Permite configurar completamente el escaneo según necesidades específicas.
- **Advanced Dynamic Scan**  
    Similar a _Advanced Scan_, pero con una diferencia clave: no requiere selección manual de plugins. En su lugar, permite definir **filtros dinámicos de plugins**.


![[Pasted image 20250716130725.png]]

#### 4. **Plugins de Nessus**

- Los **plugins** son scripts desarrollados en el lenguaje **NASL (Nessus Attack Scripting Language)**.
    
- Cada plugin contiene la lógica necesaria para detectar vulnerabilidades específicas.
    
- Los plugins se organizan en **familias** según su tipo o propósito.
    
- En fases avanzadas del curso se trabajará específicamente con plugins y la plantilla _Advanced Dynamic Scan_.

Para mas información podemos ver la [Nessus documentation](https://docs.tenable.com/nessus/Content/Settings.htm)

---

## 7.2.3. Performing a Vulnerability Scan

Empecemos con nuestro primer escaneo siguiendo los pasos a continuación:

![[Pasted image 20250716130856.png]]

Nessus tiene varias plantillas de escaneo, en este caso usaremos **Basic Network Scan**

![[Pasted image 20250716130939.png]]

Esto presentará la pantalla de configuración de escaneo que contiene las configuraciones _BASIC_, _DISCOVERY_, _ASSESSMENT_, _REPORT_, y _ADVANCED_ .

![[Pasted image 20250716131049.png]]


La pantalla predeterminada es la página de configuración general con los dos argumentos necesarios: un nombre para el análisis y una lista de objetivos. Nessus admite [multiple target specifications](https://docs.tenable.com/nessus/Content/ScanTargets.htm), incluyendo una única dirección IP, un rango de IP y un nombre de dominio completo (FQDN) delimitado por comas, o una lista de direcciones IP.

Para este ejemplo, analizaremos las siguientes máquinas: POULTRY, JENKINS, WK01 y SAMBA. Introduciremos "Basic Vulnerability Scan" en el campo Nombre y las direcciones IP de las máquinas en el campo Objetivos.

![[Pasted image 20250716131239.png]]


Dado que elegimos la plantilla de Basic Network Scan, Nessus ya ha configurado la mayoría de los ajustes. Sin embargo, es posible que la configuración predeterminada no sea exactamente la que necesitamos. Dependiendo del tipo de escaneo, el entorno, las limitaciones de tiempo y los objetivos, es posible que debamos adaptar la configuración a nuestras necesidades.

En la configuración predeterminada de esta plantilla, Nessus escanea una lista de puertos comunes. Para esta demostración, solo queremos escanear los puertos 80 y 443. Para ello, hagamos clic en _Discovery_ settings y seleccionemos _Custom_ en el menú desplegable.

![[Pasted image 20250716131457.png]]

Al seleccionar la opción **Custom** en una plantilla como **Basic Network Scan**, se habilitan menús adicionales bajo la sección **DISCOVERY**, lo que permite una personalización más avanzada, similar a la plantilla **Advanced Scan**.

#### Configuración del escaneo de puertos

Dentro del submenú **Port Scanning**, se realizan las siguientes configuraciones específicas:

- **Port scan range**: se establece el rango de puertos en `"80,443"`, lo que limita el escaneo únicamente a los puertos estándar de HTTP y HTTPS.
    
- **Consider unscanned ports as closed**: se activa esta opción para que Nessus trate **todos los puertos no especificados** como cerrados. Esto es útil para:
    
    - Reducir el tráfico de escaneo
        
    - Mejorar la precisión en reportes
        
    - Enfocar el análisis en servicios web exclusivamente
        

Esta configuración es adecuada cuando se desea realizar escaneos enfocados en puertos específicos, por ejemplo, en evaluaciones orientadas a aplicaciones web.


![[Pasted image 20250716131739.png]]


En esta demostración se personalizó la plantilla **Basic Network Scan** para escanear únicamente dos puertos TCP específicos. Por defecto, esta plantilla **no incluye escaneo de puertos UDP**, por lo que si se desea evaluar servicios basados en UDP, es necesario **activarlo manualmente**. Omitir el escaneo UDP puede llevar a perder información crítica durante una evaluación, aunque activarlo **aumenta considerablemente el tiempo de escaneo**, ya que debido a la naturaleza del protocolo, **no siempre es posible distinguir entre puertos abiertos y filtrados**.

Para optimizar el tiempo y reducir el ruido del escaneo, se desactiva el descubrimiento de hosts (**Host Discovery**), dado que ya se sabe que los objetivos están activos. Esto se realiza accediendo a **Discovery > Host Discovery** y desactivando la opción **Ping the remote host**.

![[Pasted image 20250716131954.png]]

En la configuración del escaneo, **no se definieron credenciales**, por lo tanto, el escaneo se ejecutará en modo **no autenticado** (_unauthenticated_).

Además, no se modificaron las configuraciones por defecto del menú **ASSESSMENT** dentro de la plantilla **Basic Network Scan**, lo que implica que **no se realizará fuerza bruta** sobre credenciales de usuario.

A pesar de que el ataque por fuerza bruta está deshabilitado, el escaneo generará una **cantidad significativa de tráfico de red**, especialmente al escanear múltiples hosts, lo que lo hace **altamente visible** en la red.

Una vez definida la configuración básica, el escaneo se puede iniciar seleccionando **Launch** desde el menú desplegable al lado de **Save**.

![[Pasted image 20250716132124.png]]

Inicialmente, el escaneo va a tener un status de Running en el dashboard de Nessus debajo de _My Scans_

![[Pasted image 20250716132306.png]]

Cuando el escaneo termine el estatus va a cambiar a _Completed_

![[Pasted image 20250716133242.png]]

---

## 7.2.4. Analyzing the Results

Vamos a analizar los resultados de nuestro primer escaneo de vulnerabilidades

Los resultados del análisis pueden variar debido a las constantes actualizaciones de Nessus. Los resultados de los escaneos realizados se encuentran en _My Scans_, damos click y podremos ver el analisis.

![[Pasted image 20250719151539.png]]

Nessus nos otorga un análisis por cada objetivo un análisis individual profundo

![[Pasted image 20250719152952.png]]

Nessus asigna la severidad de las vulnerabilidades por grupos, para poder visualizar las vulnerabilidades debemos ingresar a algún grupo, en este caso entraremos al apache httpd web server.

![[Pasted image 20250719155221.png]]

Podemos obtener información específica de la vulnerabilidad haciendo click sobre alguna de ellas.

![[Pasted image 20250719155419.png]]

Según la versión de Nessus podemos visualizar el VPR top Threats, el cual utiliza el [_Vulnerability Priority Rating_](https://www.tenable.com/blog/what-is-vpr-and-how-is-it-different-from-cvss) que basa el nivel de la vulnerabilidad en CRITICAL, MEDIUM y LOW determinado por dos componentes, el impacto técnico y el hilo de vulnerabilidades.

![[Pasted image 20250719160910.png]]

Dependiendo de la version de Nessus podremos ver la ventana de VPR que lista las vulnerabilidades según el modelo anterior. En mi caso no tengo la opción en la versión más reciente hasta la fecha (19/07/2025). Se vería así.

![[Pasted image 20250719161127.png]]

A pesar de ello podemos observar el VPR dentro de cada grupo de vulnerabilidades, así que no es algo por lo que debamos preocuparnos.

Nessus tiene un apartado de llamado _Remmediations_. Si Nessus detecta una vulnerabilidad, el plugin nos mostrará una estrategia o información relevante de como mitigar la vulnerabilidad. En este caso tenemos una vulnerabilidad relacionada con apache. De ahí obtenemos la siguiente información:

![[Pasted image 20250719163430.png]]

En la esquina superior derecha tenemos la opción _Report_, este nos genera un **PDF** con toda la información del análisis realizado, también podemos configurar el audit trail, que nos permite analizar el uso de un plugin en concreto en el escaneo realizado. Esto puede usarse para reducir el numero de falsos negativos.

![[Pasted image 20250719164126.png]]

Una vez demos click en el botón, se nos desplegará una ventana nueva con varias opciones de plantillas con diferente estructura, enfoque y contenido.

Para este ejemplo vamos a usar la plantilla _Detailed Vulnerabilities By Host_, que nos presenta todos los hallazgos agrupados por cada host objetivo.

![[Pasted image 20250719164424.png]]

También deberíamos tener en cuenta la plantilla _Complete List of Vulnerabilities by Host_, esta crea una lista de todas las vulnerabilidades descubiertas en vez de incluir información extendida.

Para más información de personalización de reportes podemos ir a esta documentación [_Tenable Documentation_](https://docs.tenable.com/nessus/Content/ScanReportFormats.htm)

### Ejercicio interesante con Nessus

Se debe escanear el grupo de máquinas **VM Group 1** en el **puerto 9999** utilizando la plantilla **Basic Network Scan**.

Para habilitar la generación de un **Sitemap** del servidor web (lista de páginas detectadas), se deben seguir estos pasos durante la configuración del escaneo:

1. Ir al menú **Assessment**.
    
2. Seleccionar la opción **Custom** en el menú desplegable.
    
3. Acceder a la sección **Web Applications**.
    
4. Activar la opción **Scan web applications**.
    

Luego, se lanza el escaneo. Una vez finalizado, se revisan los resultados en la sección **Web Application Sitemap**, donde Nessus muestra las páginas identificadas en los servidores web escaneados. En una de esas páginas se encuentra la **flag** que debe localizarse.

Flag

![[Pasted image 20250721131839.png]]


---

## 7.2.5. Performing an Authenticated Vulnerability Scan

En esta sección se realizará un **escaneo de vulnerabilidades autenticado** proporcionando credenciales a **Nessus**. A diferencia del escaneo no autenticado, el escaneo autenticado ofrece información más precisa y detallada, y **reduce significativamente los falsos positivos.**

El objetivo de esta demostración es realizar un escaneo autenticado sobre la máquina **DESKTOP**.

Es importante tener en cuenta que este tipo de escaneo genera:

- **Alto tráfico de red**
- **Ruido en el sistema objetivo**, como registros en logs del sistema y notificaciones del antivirus

Para iniciar el proceso, se hace clic en **New Scan** desde el panel principal de Nessus.
Aunque todas las plantillas de Nessus aceptan credenciales de usuario, para este caso se utilizará la plantilla **Credentialed Patch Audit**, que está **preconfigurada para ejecutar verificaciones de seguridad locales** en el sistema objetivo.

### Diferencias clave con otras plantillas:

- A diferencia de la **Basic Network Scan** con credenciales, la plantilla **Credentialed Patch Audit** **no realiza escaneos externos tradicionales** (no analiza servicios expuestos).
- Su enfoque está en evaluaciones internas mediante credenciales, ejecutando **solo verificaciones locales**.
### Capacidades específicas:

- Detecta **parches faltantes del sistema operativo**
- Identifica **aplicaciones desactualizadas** que podrían representar riesgos de seguridad, incluyendo vulnerabilidades de **[_privilege escalation attacks_](https://en.wikipedia.org/wiki/Privilege_escalation)**

Esta plantilla es adecuada para auditorías centradas en el estado de los parches y la configuración interna del sistema.

![[Pasted image 20250722103047.png]]

Una vez más, proporcionaremos un nombre para el escaneo y estableceremos el objetivo en ESCRITORIO.

![[Pasted image 20250722103157.png]]

En la configuración del escaneo con la plantilla **Credentialed Patch Audit**, se procede a definir las credenciales de autenticación:

1. Ir a la pestaña **Credentials**.
    
2. En la categoría **Host**, seleccionar **SSH**.
    
3. En el campo **Authentication method**, elegir **password**.
    
4. Ingresar las siguientes credenciales:
    - **Username**: `offsec`
    - **Password**: `lab`
    
5. En la opción **Elevate privileges with**, seleccionar **sudo**.
    
6. Definir al usuario con privilegios elevados:
    - **Sudo user**: `root`
    - **Sudo password**: `lab`

Estas credenciales permiten que Nessus se conecte al sistema objetivo vía SSH, escale privilegios mediante `sudo` y realice verificaciones locales de seguridad como parte del escaneo autenticado.

![[Pasted image 20250722103408.png]]

Aunque en este ejemplo se utiliza **SSH** como método de autenticación, Nessus admite **varios mecanismos de autenticación**. Para verlos todos, se puede ir al menú **Categories** en la pestaña **Credentials** y seleccionar **All**. La lista completa de métodos compatibles está disponible en la **documentación oficial de Tenable**.

### Métodos comunes por sistema operativo:

- **Linux/macOS**: autenticación típicamente por **SSH**
    
- **Windows**: se suelen usar **SMB (Server Message Block)** y **WMI (Windows Management Instrumentation)**, aunque también es posible usar SSH. Ambos métodos permiten usar cuentas locales o de dominio y soportan múltiples opciones de autenticación.

### Consideraciones para escaneos autenticados exitosos:

1. **Configuración del sistema objetivo**:
    - Asegurar que no haya **firewalls bloqueando** las conexiones desde el escáner.
        
2. **Interferencia por antivirus (AV)**:
    - Los programas AV pueden identificar el escaneo como malicioso, **terminar la conexión** o **invalidar los resultados**.
    - Soluciones posibles:
        - Agregar una **excepción en el AV**
        - **Deshabilitar temporalmente** el AV durante el escaneo

3. **User Account Control (UAC)** en Windows:
    
    - UAC limita la ejecución de comandos con privilegios administrativos por defecto.
    - Puede **interferir con escaneos autenticados**.
    - Debe configurarse para permitir la operación del escáner o desactivarse temporalmente.
    - Se recomienda revisar la documentación de Tenable antes de escanear sistemas Windows.

### Ejecución del escaneo

Dado que el sistema objetivo es **Linux y no tiene antivirus**, se puede proceder directamente al escaneo:

- Hacer clic en la flecha junto a **Save** y seleccionar **Launch** para iniciar el escaneo autenticado.

### Revisión de resultados

- Al finalizar, los hallazgos se muestran en la pestaña **Vulnerabilities**.
- Si anteriormente se usó la opción de **agrupamiento por severidad (MIXED)**, ahora se puede desactivar para ver cada hallazgo individualmente.
    - Esto se hace haciendo clic en el icono de engranaje y seleccionando **Disable Groups.**

Este proceso proporciona una visión detallada de las vulnerabilidades internas del sistema gracias a la autenticación proporcionada.

![[Pasted image 20250722103628.png]]

Después de deshabilitar los grupos, cada hallazgo se enumera por separado.

![[Pasted image 20250722103732.png]]

Tras ejecutar el escaneo autenticado, se obtiene una **lista de vulnerabilidades específicas de Ubuntu**, identificadas mediante **plugins agrupados en la familia "Ubuntu Local Security Checks"**.

### Plugins y familias de plugins en Nessus:

- Los **plugins** en Nessus son scripts que detectan vulnerabilidades.
    
- Estos se organizan en **[_plugin family_](https://www.tenable.com/plugins/nessus/families)**, las cuales agrupan plugins relacionados por contexto o tipo de tecnología.
    - Ejemplos de familias: **bases de datos**, **firewalls**, **servidores web**, etc.
        
- La familia **[_Ubuntu Local SecurityChecks_](https://www.tenable.com/plugins/nessus/families/Ubuntu%20Local%20Security%20Checks)s** contiene múltiples plugins orientados a:
    - Identificar **vulnerabilidades locales** en sistemas Ubuntu.
    - Detectar **parches faltantes** y problemas de seguridad relacionados con versiones específicas del sistema operativo.

### Interpretación de los resultados:

- En la columna **Name**, cada entrada indica:
    - La **versión de Ubuntu** afectada.
    - Una **descripción breve de la vulnerabilidad**.
    - El número del **parche de seguridad** correspondiente.

Este nivel de detalle facilita la priorización de correcciones y el análisis de riesgos en entornos basados en Ubuntu.

![[Pasted image 20250722103853.png]]

La lista también contiene datos de vulnerabilidad de aplicaciones expuestas localmente, como Firefox o curl

---

## 7.2.6. Working with Nessus Plugins

De forma predeterminada, Nessus **habilita múltiples plugins automáticamente** al ejecutar una plantilla por defecto, lo cual es útil en muchos casos. Sin embargo, es posible **ajustar la configuración para ejecutar un único plugin**, lo cual resulta especialmente útil para:

- **Validar hallazgos previos**
- **Detectar rápidamente sistemas vulnerables a una vulnerabilidad específica**

### Ejemplo: Filtrado dinámico de plugin para CVE-2021-3156

Se realizará un escaneo enfocado para verificar si la máquina **DESKTOP** es vulnerable a la **[_CVE-2021-3156_](https://www.tenable.com/cve/CVE-2021-3156)**, una vulnerabilidad de escalamiento de privilegios local que permite a un usuario sin privilegios obtener acceso como **root**.

### Pasos:

1. Iniciar un nuevo escaneo haciendo clic en **New Scan**.
2. Utilizar el **filtro dinámico de plugins** (_dynamic plugin filter_) para activar únicamente el plugin relacionado con **CVE-2021-3156**.
    - Esto permite ejecutar el escaneo **de forma más rápida y específica**, sin necesidad de cargar todos los plugins del sistema.

Esta técnica optimiza la eficiencia del escaneo y reduce el ruido cuando se busca una vulnerabilidad concreta.

![[Pasted image 20250722111933.png]]

En este caso se utilizará la plantilla **Advanced Dynamic Scan**, la cual está diseñada para permitir la configuración de un **filtro dinámico de plugins**, en lugar de habilitar o deshabilitar manualmente cada plugin individual.

### Características clave:

- La plantilla **no tiene configuraciones predefinidas**, lo que ofrece **máxima flexibilidad**.
- El **filtro dinámico de plugins** permite seleccionar automáticamente plugins relevantes según criterios específicos (por ejemplo, ID de CVE, nombre, tipo de software, etc.).

### Paso inicial:

- Para usar esta plantilla, se debe hacer clic en **Advanced Dynamic Scan** desde la interfaz de Nessus al crear un nuevo escaneo.

Esta plantilla es especialmente útil cuando se quiere ejecutar un escaneo enfocado en una o pocas vulnerabilidades específicas, como en el caso de la CVE-2021-3156.

![[Pasted image 20250722112240.png]]

Una vez más, configuraremos el nombre y el objetivo.
![[Pasted image 20250722112257.png]]

En esta fase se continuará con la plantilla **Advanced Dynamic Scan**, configurando el escaneo como **autenticado**, utilizando las **mismas credenciales SSH y sudo** que en el ejemplo anterior.

### Configuración del filtro dinámico de plugins:

La plantilla permite seleccionar plugins específicos mediante un **filtro dinámico**, sin necesidad de habilitar o deshabilitar manualmente familias o plugins individuales.
#### Pasos para filtrar por CVE:

1. Ir a la pestaña **Dynamic Plugins**.
2. Configurar los menús desplegables de la siguiente manera:
    - **Izquierdo**: seleccionar **CVE**
    - **Central**: elegir el argumento del filtro (por ejemplo, _equals_ o _contains_ según el comportamiento deseado)
    - **Derecho**: ingresar el identificador de la vulnerabilidad, en este caso: `CVE-2021-3156`
3. Hacer clic en **Preview Plugins** para previsualizar los plugins que coinciden con el filtro.

> Nota: la generación de la lista de plugins puede tardar varios minutos en completarse.

Este procedimiento permite crear un escaneo altamente específico, enfocado en detectar si el sistema objetivo es vulnerable a **CVE-2021-3156**, una vulnerabilidad de escalamiento de privilegios local.

![[Pasted image 20250722112413.png]]

Una vez que Preview Plugins termina de ejecutarse, obtenemos una lista de familias de complementos encontradas que cubren esta CVE.

![[Pasted image 20250722112717.png]]

Una funcionalidad muy útil del **filtro dinámico de plugins** en la plantilla **Advanced Dynamic Scan** es la capacidad de **combinar múltiples filtros**, lo cual permite refinar aún más la selección de plugins para el escaneo.

### Ejemplo práctico:
Dado que el sistema objetivo es un **Ubuntu Linux**, se puede agregar un segundo filtro que limite los plugins a una **familia específica** relacionada.

#### Pasos para combinar filtros:

1. Después de haber creado el filtro por **CVE** (e.g., `CVE-2021-3156`), hacer clic en el **botón "+"** junto al primer filtro.
    
2. En el nuevo conjunto de filtros:
    
    - En el menú desplegable izquierdo, seleccionar **Plugin Family**
    - En el menú derecho, elegir la familia correspondiente, por ejemplo: **Ubuntu Local Security Checks**

Este enfoque permite que Nessus ejecute únicamente los plugins relevantes **tanto por CVE específica como por sistema operativo**, haciendo el escaneo más eficiente y preciso.

![[Pasted image 20250722112814.png]]

Al agregar un nuevo filtro dinámico, se puede **restringir aún más la selección de plugins** para enfocarse únicamente en aquellos relacionados con Ubuntu.

### Configuración del segundo filtro:

1. En el nuevo filtro que aparece:
    - Seleccionar **Plugin Family** en el **menú desplegable izquierdo**.
    - Seleccionar **Ubuntu Local Security Checks** en el **menú desplegable derecho**.

Esta configuración asegura que solo se consideren **plugins pertenecientes a la familia de verificaciones locales de seguridad de Ubuntu**, combinados con el filtro anterior por **CVE-2021-3156**. De este modo, el escaneo se vuelve **altamente específico y eficiente**, orientado a detectar esa vulnerabilidad en un sistema Ubuntu.

![[Pasted image 20250722112902.png]]

> **Nota:** Según la versión de Nessus, es posible que el menú desplegable de la derecha no muestre ningún valor. En ese caso, podemos eliminar el segundo filtro del complemento y continuar sin él.


Una vez definidos los filtros dinámicos (por **CVE** y por **familia de plugin**), se procede a visualizar los plugins que cumplen ambos criterios.
### Pasos finales:

1. Hacer clic en **Preview Plugins** nuevamente para que Nessus genere la lista de plugins según los filtros aplicados.
    - Este proceso puede tardar unos minutos.

2. Una vez completado, hacer clic en el **menú desplegable** para seleccionar la familia **Ubuntu Local Security Checks**.

### Resultados mostrados por Nessus:

Nessus mostrará detalles del plugin seleccionado, incluyendo:

- **Versiones de Ubuntu afectadas**
- **Descripción breve** de la vulnerabilidad
- **Número de parche** correspondiente
- **Plugin ID** (identificador único del plugin)

Esta información permite confirmar que el plugin seleccionado es el adecuado para detectar la **CVE-2021-3156** en sistemas Ubuntu, y garantiza que el escaneo esté correctamente enfocado.

![[Pasted image 20250722114342.png]]

Podemos obtener más información haciendo clic en el complemento. La siguiente imagen muestra la información detallada del complemento especificado.

![[Pasted image 20250722114420.png]]

Tras cerrar esta ventana, podemos iniciar el análisis de vulnerabilidades como hicimos antes.
Una vez finalizado el análisis, revisemos los resultados haciendo clic en la pestaña "Vulnerabilidades".

![[Pasted image 20250722114451.png]]

El resultado muestra un hallazgo de gravedad ALTA, detectado por el complemento que especificamos con nuestro filtro dinámico. La siguiente imagen muestra la información detallada del hallazgo, lo que confirma que el objetivo es vulnerable a CVE-2021-3156.

![[Pasted image 20250722114519.png]]

El **output del plugin** también incluye una advertencia importante: Nessus **no intentó confirmar la vulnerabilidad mediante explotación**, sino que se basó únicamente en la **versión reportada** de la aplicación o sistema.

### Implicaciones:

- El resultado se genera por **correlación pasiva**, es decir, comparando la versión detectada con versiones conocidas como vulnerables.
- **No se realiza prueba activa de explotación**, por lo tanto, el hallazgo puede ser un **falso positivo**, especialmente si:    
    - Se ha aplicado un parche sin cambiar la versión.
    - La configuración del sistema mitiga la vulnerabilidad.

### Recomendación:

En una **evaluación profesional**, este tipo de hallazgos debe ser **verificado manualmente** para determinar si la vulnerabilidad es **realmente explotable** en el entorno evaluado. Esto puede incluir:

- Revisión directa del sistema.    
- Validación con pruebas controladas.
- Verificación del estado de los parches o configuración de mitigación.

Este enfoque asegura mayor precisión en los informes y reduce la probabilidad de reportar resultados erróneos.

### Ejercicio

La máquina objetivo **VM #2** ejecuta un servidor web **IIS (Internet Information Services)**. El objetivo es realizar un escaneo enfocado utilizando la plantilla **Advanced Dynamic Scan** con sus **ajustes predeterminados** y un filtro por **Plugin ID** específico.

### Pasos del procedimiento:

1. Crear un nuevo escaneo con la plantilla **Advanced Dynamic Scan**.
2. En la pestaña **Dynamic Plugins**, configurar un **filtro por Plugin ID**:
    - Menú izquierdo: seleccionar **Plugin ID**
    - Menú derecho: ingresar el valor `11714`

3. Lanzar el escaneo sobre **VM #2**.

### Análisis posterior al escaneo:

- Una vez finalizado el escaneo, revisar los resultados del plugin activado.
- El **Plugin ID 11714** está diseñado para descubrir **información sensible o rutas internas** expuestas por el servidor IIS.
- Entre los datos revelados, se encuentra una **ruta con una flag incrustada**.
    

### Consideraciones sobre formato de salida:

- Nessus puede mostrar ciertos caracteres especiales como `{` o `}` codificados en **Unicode hexadecimal** (por ejemplo, `\u007b` para `{`).
- Para identificar correctamente la **flag**, es necesario:
    - Revisar cuidadosamente la ruta revelada.
    - **Sustituir los caracteres codificados** por su representación literal.
        - `\u007b` → `{`

        - `\u007d` → `}`


Una vez decodificada la ruta, se podrá extraer y presentar la flag en el formato correcto.

![[Pasted image 20250722120218.png]]

![[Pasted image 20250722120239.png]]

![[Pasted image 20250722121101.png]]

Flag formateada: OS{a289c714873455521ca33a7b5acf1498}

---

## 7.3.1. NSE Vulnerability Scripts

Como alternativa a Nessus, se puede utilizar **NSE (Nmap Scripting Engine)** para realizar escaneos automatizados de vulnerabilidades. NSE amplía la funcionalidad de Nmap mediante scripts que permiten ejecutar tareas avanzadas de red.

### Funcionalidad de NSE:

- Los scripts permiten realizar tareas como:
    
    - **Detección de vulnerabilidades**
        
    - **Fuerza bruta**
        
    - **Descubrimiento de red**
        
    - **Extensión de detección de versiones e información del sistema**
        

### Clasificación de scripts:

- Cada script puede pertenecer a una o varias **categorías**:
    
    - **safe**: no afecta la estabilidad del sistema

    - **intrusive**: puede provocar inestabilidad, fallos o caídas del servicio
    - **vuln**: orientado a detectar vulnerabilidades conocidas
        
- Es fundamental **verificar la categoría** antes de ejecutar cualquier script para evitar impactos negativos.
    
    - Esto se puede hacer revisando:
        - La **[_NSE Documentation_](https://nmap.org/nsedoc)**
        - El contenido local del directorio de scripts en el sistema

### Enfocándonos en la categoría `vuln`:

- Para utilizar Nmap como escáner de vulnerabilidades ligero, se utilizarán **scripts de la categoría `vuln`**.
- En sistemas como **Kali Linux**, los scripts NSE están ubicados en:

```bash
cd /usr/share/nmap/scripts/

kali@kali:/usr/share/nmap/scripts$ cat script.db  | grep "\"vuln\""
Entry { filename = "afp-path-vuln.nse", categories = { "exploit", "intrusive", "vuln", } }
Entry { filename = "broadcast-avahi-dos.nse", categories = { "broadcast", "dos", "intrusive", "vuln", } }
Entry { filename = "clamav-exec.nse", categories = { "exploit", "vuln", } }
Entry { filename = "distcc-cve2004-2687.nse", categories = { "exploit", "intrusive", "vuln", } }
Entry { filename = "dns-update.nse", categories = { "intrusive", "vuln", } }
...
```


Antes de realizar un escaneo de vulnerabilidades con **NSE (Nmap Scripting Engine)**, es importante comprender cómo se estructuran y ejecutan los scripts.
### Detalles de los scripts NSE:

- Cada entrada en el archivo `script.db` incluye:
    - **Nombre del archivo**: coincide con el nombre del script `.nse` en el directorio `/usr/share/nmap/scripts/`
    - **Categorías**: indican el propósito y el impacto del script

### Scripts desactualizados y el uso de _vulners.nse_:

- Algunos scripts estándar están **desactualizados**, pero existe el script **`vulners.nse`** que mejora la detección de vulnerabilidades.
    
    - Se basa en la **Vulners Vulnerability Database** y entrega información actualizada según la versión del servicio detectado.
    - Está clasificado como:
        - **safe**: no impacta la estabilidad
        - **vuln**: relacionado con detección de vulnerabilidades
        - **external**: se comunica con fuentes externas (como Vulners API)

### Parámetro `--script` de Nmap:

- Controla qué scripts NSE se ejecutan durante un escaneo.
- Los argumentos aceptados pueden ser:
    - **Nombre de categoría** (ej.: `vuln`)
    - **Expresión booleana** (combinaciones con `and`, `or`, `not`)
    - **Lista separada por comas** de categorías
    - **Nombre completo o comodín** del script (ej.: `http-*`)
    - **Ruta absoluta** al script `.nse`
### Ejemplo de escaneo dirigido:

Para realizar un escaneo que utilice todos los scripts NSE de la categoría `vuln`, con detección de servicios y limitado al puerto 443, se usaría el siguiente comando:

```bash
sudo nmap -sV -p 443 --script "vuln" 192.168.50.124
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org )
...
PORT    STATE SERVICE VERSION
443/tcp open  http    Apache httpd 2.4.49 ((Unix))
...
| vulners: 
|   cpe:/a:apache:http_server:2.4.49:
...
        https://vulners.com/githubexploit/DF57E8F1-FE21-5EB9-8FC7-5F2EA267B09D	*EXPLOIT*
|     	CVE-2021-41773	4.3	https://vulners.com/cve/CVE-2021-41773
...
|_http-server-header: Apache/2.4.49 (Unix)
MAC Address: 00:0C:29:C7:81:EA (VMware)
```

### Componentes del comando:

- `-sV`: habilita la **detección de versiones** de servicios
- `--script vuln`: ejecuta **todos los scripts** con la categoría `vuln`
- `-p 443`: limita el escaneo al **puerto 443** (HTTPS)

Este comando proporciona una forma efectiva de realizar escaneos de vulnerabilidades enfocados utilizando Nmap como una herramienta liviana, especialmente útil cuando no se dispone de un escáner dedicado como Nessus.

En el escaneo con **Nmap** utilizando los scripts de la categoría `vuln`, se detectó que el sistema objetivo ejecuta el servicio **Apache versión 2.4.49**. La mayor parte de los resultados obtenidos provienen del script **`vulners.nse`**, el cual correlaciona información del servicio detectado con vulnerabilidades conocidas.

### Funcionalidades clave del script `vulners.nse`:

1. **Correlación de vulnerabilidades:**
    - Utiliza la versión detectada del servicio (por ejemplo, Apache 2.4.49) para identificar **vulnerabilidades conocidas** asociadas.        
    - Se basa en la **Vulners Vulnerability Database**.

2. **Información detallada entregada:**
    - **CVE identificadores** (por ejemplo, **[_CVE-2021-41773_](https://nvd.nist.gov/vuln/detail/CVE-2021-41773)**)
    - **Puntajes CVSS** que indican la severidad de la vulnerabilidad        
    - **Enlaces externos** para consultar detalles técnicos adicionales

3. **Indicadores de exploit:**
    - El script también puede mostrar vulnerabilidades que tienen un **Proof of Concept (PoC)** disponible.
    - Estas entradas están marcadas con `*EXPLOIT*`, lo cual ayuda a priorizar amenazas explotables activamente.

### Limitación crítica:

- El script `vulners.nse` **depende totalmente de una detección exitosa del servicio y su versión** (por ejemplo, mediante `-sV`).
- **Sin una identificación precisa del servicio**, el script **no podrá correlacionar vulnerabilidades**, y por lo tanto, **no mostrará resultados**.

Este flujo de trabajo convierte a Nmap, con el soporte de `vulners.nse`, en una herramienta eficaz para identificar vulnerabilidades conocidas y explotables, especialmente cuando se requiere un escaneo liviano y específico.

---

## 7.3.2. Working with NSE Scripts

En la sección anterior se utilizó la categoría `vuln` y el script `vulners.nse` para identificar vulnerabilidades basadas en versiones detectadas. Aunque `vulners.nse` ofrece una **visión general completa de todos los CVEs** relacionados con un servicio, puede ser poco práctico cuando se desea buscar **una vulnerabilidad específica**, ya que el volumen de resultados puede ser muy grande.

### Limitación del script `vulners.nse`:

- No permite filtrar por un solo CVE.
- Es útil para análisis amplios, pero no para escaneos focalizados.

### Alternativa: uso de scripts NSE dedicados

Para vulnerabilidades modernas o específicas, se recomienda utilizar **scripts NSE dedicados al CVE de interés**, en lugar de confiar únicamente en `vulners.nse`.

#### Ejemplo práctico: CVE-2021-41773

Esta es una vulnerabilidad crítica en **Apache HTTP Server 2.4.49**, que permite ejecución remota de código mediante path traversal.

### Procedimiento:

1. Buscar un script NSE dedicado a la vulnerabilidad:
     - Usar un motor de búsqueda con los términos: **CVE-2021-41773 nse**
     - Esto puede llevar a repositorios de la comunidad (por ejemplo, GitHub) o foros especializados donde desarrolladores han publicado scripts NSE personalizados.

![[Pasted image 20250722131151.png]]

2. Descargar el script `.nse` adecuado y colocarlo en el directorio de scripts de Nmap o ejecutarlo mediante ruta absoluta
3. Ejecutar el escaneo apuntando al script específico
```bash
nmap -p 80 --script /ruta/al/script-CVE-2021-41773.nse <IP>
```

Esta técnica es altamente eficiente para **detectar una sola vulnerabilidad en múltiples sistemas**, lo que resulta muy útil en auditorías enfocadas, análisis de impacto o validación de parches.


### Pasos para integrar el script en Nmap:

1. **Descargar el script NSE:**
    
    - Localizar un repositorio confiable (por ejemplo, GitHub) que contenga un script NSE para **CVE-2021-41773**.
        
    - Descargar el archivo y guardarlo en el directorio estándar de scripts de Nmap

2. **Actualizar la base de datos de scripts:**

- Antes de poder usar el script, es necesario actualizar el índice de scripts (`script.db`) ejecutando
- Esto asegura que Nmap registre el nuevo script y pueda utilizarlo en futuros escaneos.

Una vez completados estos pasos, el script estará disponible para su uso como parte de los escaneos dirigidos. Esto permite ejecutar un escaneo específico contra **CVE-2021-41773**, evitando la sobrecarga de información generada por scripts generales como `vulners.nse`.

```bash
sudo cp /home/kali/Downloads/http-vuln-cve-2021-41773.nse /usr/share/nmap/scripts/http-vuln-cve2021-41773.nse

kali@kali:~$ sudo nmap --script-updatedb
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org )
NSE: Updating rule database.
NSE: Script Database updated successfully.
Nmap done: 0 IP addresses (0 hosts up) scanned in 0.54 seconds
```

Para usar el script NSE, proporcionaremos el nombre del script, la información del destino y el número de puerto. También habilitaremos la detección de servicios.

```bash
sudo nmap -sV -p 443 --script "http-vuln-cve2021-41773" 192.168.50.124
Starting Nmap 7.92 ( https://nmap.org )
Host is up (0.00069s latency).

PORT    STATE SERVICE VERSION
443/tcp open  http    Apache httpd 2.4.49 ((Unix))
| http-vuln-cve2021-41773:
|   VULNERABLE:
|   Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.49
|     State: VULNERABLE
|               A flaw was found in a change made to path normalization in Apache HTTP Server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the expected document root. If files outside of the document root are not protected by "require all denied" these requests can succeed. Additionally this flaw could leak the source of interpreted files like CGI scripts. This issue is known to be exploited in the wild. This issue only affects Apache 2.4.49 and not earlier versions.
|           
|     Disclosure date: 2021-10-05
|     Check results:
|       
|         Verify arbitrary file read: https://192.168.50.124:443/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
...
Nmap done: 1 IP address (1 host up) scanned in 6.86 seconds
```

Tras ejecutar el script NSE específico para **CVE-2021-41773**, el resultado indica que el sistema objetivo **es vulnerable**, y proporciona información adicional sobre el fallo de seguridad.

### Valor del NSE en pruebas de penetración:

Aunque **Nmap no es un escáner de vulnerabilidades tradicional**, su motor de scripts (**NSE**) permite realizar **escaneos ligeros y focalizados** de vulnerabilidades. Esto lo convierte en una herramienta útil en los siguientes escenarios:

- Cuando **no se dispone de un escáner comercial** como Nessus.
- Para **validar hallazgos detectados por otras herramientas**.
- Para realizar **análisis rápidos** en etapas iniciales de una auditoría.
    

### Consideraciones de seguridad al usar scripts NSE:

Al igual que con cualquier escáner de vulnerabilidades, deben considerarse varios factores de riesgo:

1. **Categorías del script NSE:**
    - Ayudan a identificar el comportamiento esperado:
        - `safe`: no altera el sistema objetivo.
        - `intrusive`: puede provocar interrupciones, inestabilidad o daños.            
    - Estas etiquetas son útiles para evaluar el impacto potencial antes de ejecutar un script.

2. **Posible código malicioso:**
    - Los scripts NSE, especialmente los descargados de fuentes externas (por ejemplo, GitHub), **pueden contener código malicioso**.
    - Existe el riesgo de que un script conceda **acceso total al sistema**, ya sea de forma intencionada o por errores en su lógica.

### Recomendación clave:

Antes de ejecutar cualquier script NSE (especialmente uno personalizado o de terceros), es **obligatorio revisar su contenido**, confirmar que realiza únicamente la funcionalidad deseada, y asegurarse de que proviene de una **fuente confiable**.

En resumen, NSE es una herramienta poderosa y flexible dentro de Nmap, pero debe utilizarse con el mismo nivel de precaución y evaluación que cualquier herramienta de explotación o escaneo en un entorno profesional.

**Enlace para descargar el plugin de nmap (cve-2021-41773)**
https://github.com/RootUp/PersonalStuff/blob/master/http-vuln-cve-2021-41773.nse


Comando para obtener flag de un sitio con la vulnerabilidad del cve anterior:
curl -i --path-as-is http://192.168.135.13:443/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd